<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaloritrakker MVP</title>
    
    <style>
        :root {
            --primary-color: #0d47a1; /* Dyp Bl√• */
            --secondary-color: #4CAF50; /* Gr√∏nn */
            --warning-color: #F44336; /* R√∏d */
            --background-light: #f5f5f5;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--background-light);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        main {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            box-sizing: border-box;
        }

        .view {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .view.active {
            display: block;
        }

        h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }

        /* --- DASHBOARD STYLING --- */
        #dashboard h2 {
            margin-top: 0;
        }

        #summary {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-bottom: 20px;
        }

        .stat-box {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            margin: 0 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .stat-box p {
            font-size: 14px;
            margin: 0 0 5px 0;
            color: #555;
        }

        .stat-box span {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }

        #kcal-net {
            color: var(--primary-color);
        }

        .action-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
        }

        .action-buttons button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .action-buttons button:hover {
            background-color: #388e3c;
        }

        /* Dagens Logg */
        #daily-log-container h3 {
            color: var(--primary-color);
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        #daily-log li {
            list-style: none;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        #daily-log li span {
            font-weight: bold;
        }

        /* --- FORM STYLING --- */
        form {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-top: 10px;
            font-weight: bold;
            color: #555;
        }

        input[type="number"], select {
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .submit-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-button:hover {
            background-color: #0d3b84;
        }

        .back-button {
            background: #ccc;
            color: #333;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
        }

        /* Styling for Ukentlig Oppsummering */
        #weekly-summary {
            background-color: #e3f2fd; /* Lys bl√• bakgrunn */
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0 30px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--primary-color);
            text-align: left;
        }

        #weekly-summary h3 {
            color: var(--primary-color);
            font-size: 18px;
            margin: 0 0 10px 0;
            padding: 0;
        }

        #weekly-summary p {
            margin: 5px 0;
            font-size: 15px;
            color: #333;
        }
        
        /* Styling for Sett M√•l-funksjonen */
        #daily-goal-container {
            background-color: #fff3e0; /* Lysegul/oransje bakgrunn */
            padding: 10px 15px;
            margin: 0 0 15px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #daily-goal-container p {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        #daily-goal-value {
            font-weight: 700;
            color: #ff6f00; /* Dyp oransje */
        }

        #set-goal-link {
            color: #1976d2; /* Bl√• lenke */
            text-decoration: none;
            font-weight: 600;
            padding: 5px 10px;
            border: 1px solid #1976d2;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        #set-goal-link:active {
            background-color: #e0f7fa;
        }
    </style>
    </head>
<body>
    <main>
        
        <div id="dashboard" class="view active">
            <h2>Kaloritrakker</h2>

            <div id="daily-goal-container">
                <p>Dagens M√•l: <span id="daily-goal-value"></span> Kcal</p>
                <a href="#" id="set-goal-link">Sett M√•l</a>
            </div>

            <div id="weekly-summary">
                <h3>Ukentlig Oppsummering (Man ‚Äì I dag)</h3>
                <p id="week-in">Inntatt: 0 Kcal</p>
                <p id="week-burned">Forbrukt: 0 Kcal</p>
            </div>
            
            <div id="summary">
                <div class="stat-box" style="border-left: 3px solid #1e88e5;">
                    <p>Inntatt</p>
                    <span id="kcal-in">0</span>
                </div>
                <div class="stat-box" style="border-left: 3px solid var(--secondary-color);">
                    <p>Forbrukt</p>
                    <span id="kcal-burned">0</span>
                </div>
                <div class="stat-box" style="border-left: 3px solid var(--primary-color);">
                    <p>Netto</p>
                    <span id="kcal-net">0</span>
                </div>
            </div>

            <div class="action-buttons">
                <button id="show-add-meal">Legg til M√•ltid üçΩÔ∏è</button>
                <button id="show-add-workout">Legg til Trening üí™</button>
            </div>
            
            <div id="daily-log-container">
                <h3>Dagens Logg <button id="reset-button" style="background: var(--warning-color); color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; float: right;">T√∏m dag</button></h3>
                <ul id="daily-log">
                    </ul>
            </div>
        </div>

        <div id="add-meal" class="view">
            <h2>Legg til M√•ltid</h2>
            <form id="meal-form">
                <label for="meal-type">Beskrivelse:</label>
                <select id="meal-type" required>
                    <option value="Frokost">Frokost</option>
                    <option value="Lunsj">Lunsj</option>
                    <option value="Middag">Middag</option>
                    <option value="Kveldsmat">Kveldsmat</option>
                    <option value="Snacks">Snacks</option>
                </select>

                <label for="meal-kcal">Antall Kcal:</label>
                <input type="number" id="meal-kcal" required min="1" placeholder="F.eks. 550">

                <button type="submit" class="submit-button">Loggf√∏r M√•ltid</button>
                <button type="button" class="back-button" data-target="dashboard">Tilbake til Dashboard</button>
            </form>
        </div>

        <div id="add-workout" class="view">
            <h2>Legg til Trening</h2>
            <form id="workout-form">
                <label for="workout-type">Type Trening (ca.):</label>
                <select id="workout-type" required>
                    <option value="">Velg type</option>
                    <option value="manual">Manuell Kcal inntasting</option>
                    <option value="250">Lett Tur (250 Kcal)</option>
                    <option value="400">Rask G√•tur / Yoga (400 Kcal)</option>
                    <option value="650">L√∏ping / Hard Trening (650 Kcal)</option>
                    <option value="800">Intensiv Cardio / Styrke (800 Kcal)</option>
                </select>

                <div id="manual-kcal-input" style="display: none; margin-top: 10px;">
                    <label for="workout-kcal">Manuell Kcal Forbrukt:</label>
                    <input type="number" id="workout-kcal" min="1" placeholder="F.eks. 450">
                </div>

                <button type="submit" class="submit-button">Loggf√∏r Trening</button>
                <button type="button" class="back-button" data-target="dashboard">Tilbake til Dashboard</button>
            </form>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // KONSTANTER
            const DAILY_GOAL_KEY = 'dailyGoal';
            const DEFAULT_GOAL = 2000;

            // Funksjon for √• hente lagret m√•l eller standardverdi
            function getDailyGoalValue() {
                const goal = localStorage.getItem(DAILY_GOAL_KEY);
                // Returnerer lagret verdi (konvertert til tall) eller standardverdi (2000)
                return parseInt(goal) || DEFAULT_GOAL;
            }

            // DOM-elementer
            const dashboard = document.getElementById('dashboard');
            const kcalInElement = document.getElementById('kcal-in');
            const kcalBurnedElement = document.getElementById('kcal-burned');
            const kcalNetElement = document.getElementById('kcal-net');
            const dailyLogList = document.getElementById('daily-log');
            const mealForm = document.getElementById('meal-form');
            const workoutForm = document.getElementById('workout-form');
            const workoutTypeSelect = document.getElementById('workout-type');
            const manualKcalInputDiv = document.getElementById('manual-kcal-input');

            // Funksjon for √• bytte visning
            function changeView(targetId) {
                document.querySelectorAll('.view').forEach(view => {
                    view.classList.remove('active');
                });
                document.getElementById(targetId).classList.add('active');
            }

            // FUNKSJON: Sett dagsm√•let (Brukes av Sett M√•l-lenken)
            function setDailyGoal() {
                let currentGoal = getDailyGoalValue();
                const newGoal = prompt(`Angi ditt nye daglige kaloriforbruksm√•l (i Kcal). N√•v√¶rende: ${currentGoal}`, currentGoal);
                
                if (newGoal === null) return; // Bruker trykket Avbryt
                
                const goalValue = parseInt(newGoal);
                
                if (goalValue > 500 && goalValue < 10000) {
                    localStorage.setItem(DAILY_GOAL_KEY, goalValue);
                    updateDashboard();
                } else {
                    alert("Vennligst oppgi et realistisk m√•l mellom 500 og 10000 Kcal.");
                }
            }

            // Event listeners for navigasjon
            document.getElementById('show-add-meal').addEventListener('click', () => changeView('add-meal'));
            document.getElementById('show-add-workout').addEventListener('click', () => changeView('add-workout'));
            document.querySelectorAll('.back-button').forEach(button => {
                button.addEventListener('click', (e) => changeView(e.target.dataset.target));
            });
            // Event listener for Sett M√•l
            document.getElementById('set-goal-link').addEventListener('click', function(e) {
                e.preventDefault();
                setDailyGoal();
            });

            // Funksjon for √• laste ALL loggdata fra localStorage
            function getAllLogData() {
                return JSON.parse(localStorage.getItem('dailyLog')) || {};
            }

            // Beregner startdatoen for innev√¶rende uke (Mandag)
            function getStartOfWeek() {
                const now = new Date();
                const dayOfWeek = now.getDay(); // 0 = S√∏ndag, 1 = Mandag, osv.
                const diff = now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Justerer til Mandag
                const startOfWeek = new Date(now.setDate(diff));
                startOfWeek.setHours(0, 0, 0, 0); // Setter klokken til midnatt
                return startOfWeek;
            }

            // Henter loggf√∏ringer kun for innev√¶rende uke
            function getWeekLog() {
                const allLog = getAllLogData();
                const startOfWeek = getStartOfWeek().getTime();
                const weekLog = [];
                const uniqueDaysLoggedThisWeek = new Set(); 

                for (const dateString in allLog) {
                    const date = new Date(dateString);

                    if (date.getTime() >= startOfWeek) {
                        weekLog.push(...allLog[dateString]);
                        uniqueDaysLoggedThisWeek.add(dateString);
                    }
                }
                
                return { log: weekLog, days: uniqueDaysLoggedThisWeek.size };
            }

            // Henter kun dagens logg
            function getDailyLog() {
                const today = new Date().toDateString();
                return getAllLogData()[today] || []; 
            }

            // Funksjon for √• lagre data til localStorage
            function saveLogEntry(entry) {
                const today = new Date().toDateString();
                const log = getAllLogData();
                
                if (!log[today]) {
                    log[today] = [];
                }
                
                log[today].push(entry);
                localStorage.setItem('dailyLog', JSON.stringify(log));
                updateDashboard();
                changeView('dashboard');
            }

            // Funksjon for √• oppdatere dashboard (beregninger og visning)
            function updateDashboard() {
                const dailyLog = getDailyLog();
                const { log: weeklyLog, days: daysInWeekLogged } = getWeekLog();
                
                const dailyGoal = getDailyGoalValue();
                
                // Daglige base = M√•l
                let dailyKcalBurned = dailyGoal; 
                // Ukentlig base = M√•l * antall dager med loggf√∏ring
                let weeklyKcalBurned = daysInWeekLogged * dailyGoal;
                
                let dailyKcalIn = 0;
                let weeklyKcalIn = 0;
                
                dailyLogList.innerHTML = '';

                // 1. Beregn Daglige Totaler og vis detaljert logg
                dailyLog.forEach(entry => {
                    if (entry.type === 'meal') {
                        dailyKcalIn += entry.kcal;
                        dailyLogList.innerHTML += `<li>${entry.time} | üçΩÔ∏è ${entry.description} <span>+${entry.kcal} Kcal</span></li>`;
                    } else if (entry.type === 'workout') {
                        dailyKcalBurned += entry.kcal; 
                        dailyLogList.innerHTML += `<li>${entry.time} | üí™ ${entry.description} <span>-${entry.kcal} Kcal</span></li>`;
                    }
                });

                // 2. Beregn Ukentlige Totaler
                weeklyLog.forEach(entry => {
                    if (entry.type === 'meal') {
                        weeklyKcalIn += entry.kcal;
                    } else if (entry.type === 'workout') {
                        weeklyKcalBurned += entry.kcal;
                    }
                });

                // Vis daglige data
                const totalNet = dailyKcalIn - dailyKcalBurned;
                
                document.getElementById('daily-goal-value').textContent = dailyGoal;
                
                kcalInElement.textContent = dailyKcalIn;
                kcalBurnedElement.textContent = dailyKcalBurned;
                kcalNetElement.textContent = totalNet;
                // Fargelegg netto-tallet
                kcalNetElement.style.color = totalNet > 0 ? '#F44336' : (totalNet < 0 ? '#4CAF50' : '#0d47a1');

                // Vis ukentlige data
                document.getElementById('week-in').textContent = `Inntatt: ${weeklyKcalIn} Kcal`;
                document.getElementById('week-burned').textContent = `Forbrukt: ${weeklyKcalBurned} Kcal`;
            }

            // H√•ndter skjemaer
            mealForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const kcal = parseInt(document.getElementById('meal-kcal').value);
                const type = document.getElementById('meal-type').value;
                
                if (kcal && type) {
                    const entry = {
                        type: 'meal',
                        description: type,
                        kcal: kcal,
                        time: new Date().toLocaleTimeString('no-NO', { hour: '2-digit', minute: '2-digit' })
                    };
                    saveLogEntry(entry);
                    mealForm.reset();
                }
            });

            workoutForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const selectedOption = workoutTypeSelect.value;
                let kcal = 0;
                let description = '';

                if (selectedOption === 'manual') {
                    kcal = parseInt(document.getElementById('workout-kcal').value);
                    description = 'Manuell Trening';
                } else {
                    kcal = parseInt(selectedOption);
                    description = workoutTypeSelect.options[workoutTypeSelect.selectedIndex].text.split('(')[0].trim();
                }
                
                if (kcal > 0) {
                    const entry = {
                        type: 'workout',
                        description: description,
                        kcal: kcal,
                        time: new Date().toLocaleTimeString('no-NO', { hour: '2-digit', minute: '2-digit' })
                    };
                    saveLogEntry(entry);
                    workoutForm.reset();
                    manualKcalInputDiv.style.display = 'none'; 
                }
            });

            workoutTypeSelect.addEventListener('change', function() {
                if (this.value === 'manual') {
                    manualKcalInputDiv.style.display = 'block';
                    document.getElementById('workout-kcal').setAttribute('required', 'required');
                } else {
                    manualKcalInputDiv.style.display = 'none';
                    document.getElementById('workout-kcal').removeAttribute('required');
                }
            });
            
            // H√•ndter T√∏m Logg-knappen
            document.getElementById('reset-button').addEventListener('click', function() {
                if (confirm("Er du sikker p√• at du vil t√∏mme loggen for i dag?")) {
                    const today = new Date().toDateString();
                    const log = getAllLogData();
                    
                    delete log[today]; 
                    localStorage.setItem('dailyLog', JSON.stringify(log));
                    updateDashboard();
                }
            });

            // Initial lasting av data
            updateDashboard();
        });
    </script>
    </body>
</html>
